<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Set up AEME for a new lake • AEME</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Set up AEME for a new lake">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AEME</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/aeme-inputs.html">AEME Inputs</a></li>
    <li><a class="dropdown-item" href="../articles/guide-aeme.html">Guide to AEME</a></li>
    <li><a class="dropdown-item" href="../articles/intro-aeme.html">Introduction to AEME</a></li>
    <li><a class="dropdown-item" href="../articles/lernzmp-aeme.html">Using LERNZmp with AEME</a></li>
    <li><a class="dropdown-item" href="../articles/setup-new-lake.html">Set up AEME for a new lake</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="setup-new-lake_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="setup-new-lake_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="setup-new-lake_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="setup-new-lake_files/leaflet-1.3.1/leaflet.js"></script><link href="setup-new-lake_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="setup-new-lake_files/proj4-2.6.2/proj4.min.js"></script><script src="setup-new-lake_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="setup-new-lake_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="setup-new-lake_files/leaflet-binding-2.2.2/leaflet.js"></script><script src="setup-new-lake_files/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script><script src="setup-new-lake_files/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Set up AEME for a new lake</h1>
            
      

      <div class="d-none name"><code>setup-new-lake.Rmd</code></div>
    </div>

    
    
<p>Setting up the Aquatic Ecosystem Model Ensemble is straight forward
and can be done in a few steps. This vignette will guide you through the
process of setting up the model for a lake in New Zealand.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://limnotrack.github.io/AEME/">AEME</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'AEME'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     time</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span> <span class="co"># For spatial data</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.2, GDAL 3.9.3, PROJ 9.4.1; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span> <span class="co"># For mapping</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_mode.html" class="external-link">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span> <span class="co"># Set tmap mode to interactive view model</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> tmap mode set to <span style="color: #0000BB;">"view"</span>.</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_options.html" class="external-link">tmap_options</a></span><span class="op">(</span>basemap.server <span class="op">=</span> <span class="st">"OpenStreetMap"</span><span class="op">)</span> <span class="co"># Set the basemap to OpenStreetMap</span></span></code></pre></div>
<div class="section level2">
<h2 id="lake-data">Lake data<a class="anchor" aria-label="anchor" href="#lake-data"></a>
</h2>
<p>The first step is to define the lake data. This includes the location
of the lake, the depth and area of the lake, and the elevation of the
lake.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the location of the lake</span></span>
<span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">36.8898</span></span>
<span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fl">174.46898</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the location of the lake in a map</span></span>
<span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="va">lat</span>, lon <span class="op">=</span> <span class="va">lon</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_bubbles</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_view.html" class="external-link">tm_view</a></span><span class="op">(</span>set_view <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"attributionControl":true},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"addLayersControl","args":[[],"coords",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"maxNativeZoom":17,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addCircleMarkers","args":[-36.8898,174.46898,9.3331,null,"coords",{"interactive":false,"className":"","pane":"tmap401","stroke":true,"color":"#404040","weight":1,"opacity":1,"fill":true,"fillColor":"#999999","fillOpacity":1},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[-36.8898,174.46898],16,[]],"limits":{"lat":[-36.8898,-36.8898],"lng":[174.46898,174.46898]}},"evals":[],"jsHooks":[]}</script><div class="section level3">
<h3 id="get-lake-shapefile">Get lake shapefile<a class="anchor" aria-label="anchor" href="#get-lake-shapefile"></a>
</h3>
<p>If you have a shapefile for the lake, you can use the <code>sf</code>
package to read it in. However, if you do not have a shapefile you can
download most lake shapefiles from <a href="https://www.openstreetmap.org/" class="external-link">OpenStreetMap</a> using the <a href="https://docs.ropensci.org/osmdata/" class="external-link"><code>osmdata</code></a>
package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmdata/" class="external-link">osmdata</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Data (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright</span></span>
<span></span>
<span><span class="co"># Get lake shapefile</span></span>
<span><span class="va">osm_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html" class="external-link">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">"New Zealand"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html" class="external-link">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"name"</span>, value <span class="op">=</span> <span class="st">"Lake Wainamu"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html" class="external-link">osmdata_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract lake polygon</span></span>
<span><span class="va">lake</span> <span class="op">&lt;-</span> <span class="va">osm_data</span><span class="op">$</span><span class="va">osm_multipolygons</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lake</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 8 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 174.4645 ymin: -36.89192 xmax: 174.4756 ymax: -36.88651</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;            osm_id         name name:mi natural ref:linz:place_id         type</span></span>
<span><span class="co">#&gt; 16007084 16007084 Lake Wainamu Wainamu   water             26277 multipolygon</span></span>
<span><span class="co">#&gt;           wikidata       wikipedia                       geometry</span></span>
<span><span class="co">#&gt; 16007084 Q85173632 en:Lake Wainamu POLYGON ((174.4665 -36.8869...</span></span></code></pre></div>
<p>Visualise the lake shapefile on a map.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the lake shapefile</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">lake</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"attributionControl":true},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"addLayersControl","args":[[],"lake",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"maxNativeZoom":17,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addPolygons","args":[[[[{"lng":[174.4665076,174.466466,174.4664097,174.4662997,174.4662353,174.4659784,174.465911,174.4658819,174.4658337,174.4657552,174.4656969,174.4656365,174.465595,174.4656084,174.4655807,174.4656251,174.4656125,174.4655699,174.465362,174.4651102,174.4649211,174.4649425,174.4649653,174.4649318,174.4648124,174.4647977,174.4647413,174.464681,174.4645643,174.4645147,174.4645174,174.4645402,174.4646247,174.464905,174.4651893,174.4652711,174.4652604,174.4652067,174.4653194,174.4654334,174.4655514,174.4657753,174.4660623,174.4662353,174.4664338,174.4665787,174.4666819,174.4668093,174.4669904,174.4672586,174.4674034,174.4676542,174.4679815,174.4682416,174.46853,174.4687888,174.4689819,174.4691817,174.4692756,174.4692488,174.4692904,174.4693682,174.469509,174.4697115,174.469749,174.4698429,174.4700333,174.4702157,174.4703284,174.4705778,174.4708273,174.4711317,174.4715568,174.4717567,174.4718492,174.4720343,174.4722603,174.472452,174.4725446,174.4725479,174.472729,174.4729516,174.4731608,174.4732735,174.4733646,174.4739185,174.4742538,174.4747353,174.4751711,174.4753803,174.4755211,174.4755828,174.475631,174.4756405,174.4755694,174.4754407,174.4753845,174.4753334,174.4751792,174.475037,174.4747835,174.4745663,174.4744053,174.4742538,174.4741398,174.4740623,174.4739614,174.4737978,174.4736704,174.4734371,174.4732332,174.4731085,174.4729784,174.4726123,174.4722663,174.4721161,174.471994,174.4718009,174.4715783,174.4712806,174.4711183,174.471015,174.4708836,174.4705832,174.4701675,174.4699556,174.4696739,174.4693628,174.4691241,174.4689202,174.4686761,174.4681075,174.4677704,174.4676542,174.4674021,174.4672063,174.4670373,174.4669408,174.4666108,174.4663399,174.4662246,174.466171,174.4661307,174.466179,174.4662246,174.4664285,174.4665076],"lat":[-36.8869546,-36.8868592,-36.8868227,-36.8866972,-36.8865728,-36.8866144,-36.8865761,-36.88659,-36.88661139999999,-36.8865594,-36.8865481,-36.8865116,-36.886525,-36.8866425,-36.8867193,-36.8868848,-36.8870503,-36.8872004,-36.8875981,-36.8879768,-36.8881377,-36.88817959999999,-36.88830189999999,-36.8883737,-36.8883394,-36.88823959999999,-36.8882075,-36.8882321,-36.8883179,-36.8884113,-36.88848309999999,-36.888659,-36.8887995,-36.8889915,-36.889161,-36.8892661,-36.88946239999999,-36.8896405,-36.8897746,-36.889855,-36.88989249999999,-36.8899183,-36.8898689,-36.8898443,-36.8898411,-36.889781,-36.8898389,-36.8898496,-36.8899633,-36.89011129999999,-36.89039559999999,-36.8905608,-36.8907034,-36.890816,-36.8908482,-36.8909008,-36.89095870000001,-36.89110030000001,-36.89118819999999,-36.8913888,-36.89152929999999,-36.8915926,-36.8915647,-36.8914982,-36.8914542,-36.8914156,-36.8913663,-36.89120320000001,-36.8911711,-36.89124400000001,-36.8912998,-36.89136790000001,-36.891503,-36.89152130000001,-36.89140010000001,-36.891318,-36.8914398,-36.891488,-36.8916334,-36.8918168,-36.8919015,-36.8919165,-36.8917964,-36.8914339,-36.8913137,-36.8912933,-36.8912697,-36.8912753,-36.89116569999999,-36.8911046,-36.8911325,-36.89116999999999,-36.89119629999999,-36.8911292,-36.8910531,-36.8909748,-36.89090139999999,-36.8909136,-36.8908943,-36.890815,-36.890697,-36.8907002,-36.8906873,-36.89065190000001,-36.8905769,-36.8904897,-36.8904996,-36.89039020000001,-36.8903688,-36.8902991,-36.8903237,-36.8904299,-36.89054359999999,-36.890535,-36.8904203,-36.8902991,-36.89018,-36.8902175,-36.8901703,-36.89003089999999,-36.88991180000001,-36.8898745,-36.8898882,-36.88986459999999,-36.8898217,-36.8897831,-36.8896072,-36.8894785,-36.8894571,-36.8893391,-36.889294,-36.88897009999999,-36.8886928,-36.8886633,-36.88860329999999,-36.888541,-36.8883308,-36.88819569999999,-36.88803689999999,-36.8878782,-36.8877966,-36.88764,-36.8874577,-36.887329,-36.8872603,-36.8871413,-36.8869546]},{"lng":[174.4686037,174.4684267,174.4682966,174.4682752,174.4683127,174.4683905,174.468538,174.4686346,174.4687258,174.4686788,174.4686037],"lat":[-36.8895375,-36.88949890000001,-36.88944740000001,-36.8893369,-36.8892769,-36.8892479,-36.8892458,-36.8893176,-36.8894796,-36.8895321,-36.8895375]}]]],"X1","lake",{"interactive":false,"className":"","pane":"tmap401","stroke":true,"color":"#404040","weight":2,"opacity":1,"fill":true,"fillColor":"#00000000","fillOpacity":1,"dashArray":"","smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"fitBounds":[-36.892024598,174.464292184,-36.886403502,174.475863016,[]],"limits":{"lat":[-36.8919165,-36.8865116],"lng":[174.4645147,174.4756405]}},"evals":[],"jsHooks":[]}</script><p>As you can see it matches the location of the lake we defined earlier
and that it perfectly matches the outline from the OpenStreetMap
polygon.</p>
</div>
<div class="section level3">
<h3 id="depth-and-area-data">Depth and area data<a class="anchor" aria-label="anchor" href="#depth-and-area-data"></a>
</h3>
<p>The depth and area of the lake are required for the model. These can
be obtained from a variety of sources. For this example, we will use the
known depth of the lake (13.07 m), however for the area we will
calculate this from the shapefile.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set depth &amp; area</span></span>
<span><span class="va">depth</span> <span class="op">&lt;-</span> <span class="fl">13.07</span> <span class="co"># Depth of the lake in metres</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the area of the lake in m2</span></span>
<span><span class="va">area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">lake</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="st">"m^2"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">area</span></span>
<span><span class="co">#&gt; [1] 156875.6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="elevation-data">Elevation data<a class="anchor" aria-label="anchor" href="#elevation-data"></a>
</h3>
<p>Elevation data can be acquired for New Zealand from the digital
elevation model hosted on the LINZ Data Service. There is a wrapper
function for this in the <code>aemetools</code> package. This requires
an API key from LINZ.</p>
<p>You can easily create a key on the LINZ website: <a href="https://data.linz.govt.nz/" class="external-link uri">https://data.linz.govt.nz/</a> or use the function within
the <code>aemetools</code> package to create one.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">aemetools</span><span class="fu">::</span><span class="fu"><a href="https://limnotrack.github.io/aemetools/reference/create_linz_key.html" class="external-link">create_linz_key</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then adding it to your <code>.Renviron</code> file.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add the LINZ API key to your .Renviron file</span></span>
<span><span class="fu">aemetools</span><span class="fu">::</span><span class="fu"><a href="https://limnotrack.github.io/aemetools/reference/add_linz_key.html" class="external-link">add_linz_key</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"your_key_here"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>get_dem_value</code> function will return the elevation of
the lake in metres above sea level.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the elevation of the lake</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"LINZ_KEY"</span><span class="op">)</span></span>
<span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="fu">aemetools</span><span class="fu">::</span><span class="fu"><a href="https://limnotrack.github.io/aemetools/reference/get_dem_value.html" class="external-link">get_dem_value</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="va">lat</span>, lon <span class="op">=</span> <span class="va">lon</span>, key <span class="op">=</span> <span class="va">key</span><span class="op">)</span></span>
<span><span class="va">elevation</span> <span class="co"># in metres above sea level</span></span>
<span><span class="co">#&gt; [1] 29</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elevation</span></span>
<span><span class="co">#&gt; [1] 29</span></span></code></pre></div>
<p>We will now create a list of the lake data. This will be used to
construct the AEME object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define lake list</span></span>
<span><span class="va">lake</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Wainamu"</span>,</span>
<span>    id <span class="op">=</span> <span class="fl">45819</span>,</span>
<span>    latitude <span class="op">=</span> <span class="va">lat</span>,</span>
<span>    longitude <span class="op">=</span> <span class="va">lon</span>,</span>
<span>    elevation <span class="op">=</span> <span class="va">elevation</span>,</span>
<span>    depth <span class="op">=</span> <span class="va">depth</span>,</span>
<span>    area <span class="op">=</span> <span class="va">area</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="time-data">Time data<a class="anchor" aria-label="anchor" href="#time-data"></a>
</h2>
<p>The time data is required for the model. This includes the start and
stop times for the model run.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define start and stop times</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="st">"2020-08-01 00:00:00"</span></span>
<span><span class="va">stop</span> <span class="op">&lt;-</span> <span class="st">"2021-06-30 00:00:00"</span></span>
<span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    start <span class="op">=</span> <span class="va">start</span>,</span>
<span>    stop <span class="op">=</span> <span class="va">stop</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h2>
<div class="section level3">
<h3 id="meteorological-data">Meteorological data<a class="anchor" aria-label="anchor" href="#meteorological-data"></a>
</h3>
<div class="section level4">
<h4 id="download-era5-data">Download ERA5 data<a class="anchor" aria-label="anchor" href="#download-era5-data"></a>
</h4>
<p>We will use the <code>aemetools</code> package to download the ERA5
meteorological data for the location of our lake. This only works for
locations in New Zealand.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get ERA5 meteorological data</span></span>
<span><span class="va">met</span> <span class="op">&lt;-</span> <span class="fu">aemetools</span><span class="fu">::</span><span class="fu"><a href="https://limnotrack.github.io/aemetools/reference/get_era5_point.html" class="external-link">get_era5_point</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="va">lat</span>, lon <span class="op">=</span> <span class="va">lon</span>, years <span class="op">=</span> <span class="fl">2020</span><span class="op">:</span><span class="fl">2021</span><span class="op">)</span></span></code></pre></div>
<p>View the summary of the meteorological data. The units have been
converted to more common units used in aquatic ecosystem modelling.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summary of meteorological data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">met</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Date              MET_tmpair       MET_tmpdew       MET_wnduvu     </span></span>
<span><span class="co">#&gt;  Min.   :2020-01-01   Min.   : 9.137   Min.   : 3.094   Min.   :-10.826  </span></span>
<span><span class="co">#&gt;  1st Qu.:2020-07-01   1st Qu.:13.406   1st Qu.: 9.326   1st Qu.: -2.087  </span></span>
<span><span class="co">#&gt;  Median :2020-12-31   Median :15.801   Median :11.932   Median :  1.425  </span></span>
<span><span class="co">#&gt;  Mean   :2020-12-31   Mean   :15.868   Mean   :11.835   Mean   :  1.128  </span></span>
<span><span class="co">#&gt;  3rd Qu.:2021-07-01   3rd Qu.:18.327   3rd Qu.:14.488   3rd Qu.:  4.256  </span></span>
<span><span class="co">#&gt;  Max.   :2021-12-31   Max.   :21.985   Max.   :19.221   Max.   : 10.963  </span></span>
<span><span class="co">#&gt;    MET_wnduvv         MET_pprain        MET_ppsnow          MET_prsttn    </span></span>
<span><span class="co">#&gt;  Min.   :-10.1534   Min.   : 0.0000   Min.   :0.000e+00   Min.   : 98312  </span></span>
<span><span class="co">#&gt;  1st Qu.: -2.2161   1st Qu.: 0.1230   1st Qu.:0.000e+00   1st Qu.:100537  </span></span>
<span><span class="co">#&gt;  Median :  0.8029   Median : 0.9502   Median :0.000e+00   Median :101066  </span></span>
<span><span class="co">#&gt;  Mean   :  0.5009   Mean   : 4.2050   Mean   :4.553e-16   Mean   :101004  </span></span>
<span><span class="co">#&gt;  3rd Qu.:  3.4222   3rd Qu.: 4.7504   3rd Qu.:2.168e-16   3rd Qu.:101481  </span></span>
<span><span class="co">#&gt;  Max.   :  9.2317   Max.   :51.6713   Max.   :3.470e-15   Max.   :102963  </span></span>
<span><span class="co">#&gt;    MET_radswd    </span></span>
<span><span class="co">#&gt;  Min.   : 13.58  </span></span>
<span><span class="co">#&gt;  1st Qu.:110.94  </span></span>
<span><span class="co">#&gt;  Median :173.46  </span></span>
<span><span class="co">#&gt;  Mean   :187.14  </span></span>
<span><span class="co">#&gt;  3rd Qu.:262.12  </span></span>
<span><span class="co">#&gt;  Max.   :530.52</span></span></code></pre></div>
<p>The depth of this lake is 13.07 m, the area is 152343 m2, and the
light extinction coefficient (Kw) is 1.31 m-1.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set Kw</span></span>
<span><span class="va">Kw</span> <span class="op">&lt;-</span> <span class="fl">1.31</span> <span class="co"># Light extinction coefficient in m-1</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="hypsograph-data">Hypsograph data<a class="anchor" aria-label="anchor" href="#hypsograph-data"></a>
</h3>
<p>If you have hypsograph data for the lake, you can use it as input for
the model. This is a critical input for the model, as it defines the
relationship between the lake area and the lake elevation.</p>
<p>However, if you do not have hypsograph data, the model will use a
simple cone-shaped hypsograph based on the lake depth and area. This is
not ideal, but it will work for this example.</p>
<p>Required column names for the hypsograph data are <code>area</code>,
<code>elev</code>, and <code>depth</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a simple hypsograph</span></span>
<span><span class="va">hypsograph_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">area</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                         elev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">elevation</span>, <span class="va">elevation</span> <span class="op">-</span> <span class="va">depth</span><span class="op">)</span>,</span>
<span>                         depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="va">depth</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hypsograph_simple</span></span>
<span><span class="co">#&gt;       area  elev  depth</span></span>
<span><span class="co">#&gt; 1 156875.6 29.00   0.00</span></span>
<span><span class="co">#&gt; 2      0.0 15.93 -13.07</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the hypsograph</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hypsograph_simple</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">area</span>, y <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Area (m2)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Elevation (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="setup-new-lake_files/figure-html/plot-hypsograph-1.png" width="700"></p>
<p>As you can see, the hypsograph is a simple cone shape. Ideally, you
would have more detailed hypsograph data for your lake.</p>
<p>If you have information regarding the maximum depth of the lake, the
surface area and an estimate of volume development, you can generate a
hypsograph using the <code>generate_hypsograph</code> function. The
<code>volume_development</code> parameter is a scaling factor for the
volume development of the lake. Values below 1.5 are lakes with a
concave hypsograph, values above 1.5 are lakes with a convex hypsograph,
and values of 1.5 are lakes with a linear hypsograph.</p>
<p>For Wainamu Lake, we will use a volume development of 1.62 which was
calculated from a bathymetry survey of the lake. You can view this on
the <a href="https://limnotrack.shinyapps.io/LERNZmp/" class="external-link">LERNZmp
platform</a>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Generate a hypsograph</span></span>
<span><span class="va">hypsograph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_hypsograph.html">generate_hypsograph</a></span><span class="op">(</span>max_depth <span class="op">=</span> <span class="va">depth</span>, surface_area <span class="op">=</span> <span class="va">area</span>,</span>
<span>                                  volume_development <span class="op">=</span> <span class="fl">0.5</span>, elev <span class="op">=</span> <span class="va">elevation</span>,</span>
<span>                                  ext_elev <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hypsograph</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">area</span>, y <span class="op">=</span> <span class="va">elev</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hypsograph_simple</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">area</span>, y <span class="op">=</span> <span class="va">elev</span><span class="op">)</span>, </span>
<span>            linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Area (m2)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Elevation (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="setup-new-lake_files/figure-html/generate-hypsograph-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define input list</span></span>
<span><span class="va">input</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    init_depth <span class="op">=</span> <span class="va">depth</span>,</span>
<span>    hypsograph <span class="op">=</span> <span class="va">hypsograph</span>,</span>
<span>    meteo <span class="op">=</span> <span class="va">met</span>,</span>
<span>    use_lw <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    Kw <span class="op">=</span> <span class="va">Kw</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="construct-the-aeme-object">Construct the AEME object<a class="anchor" aria-label="anchor" href="#construct-the-aeme-object"></a>
</h2>
<p>The <code>aeme_constructor</code> function will take the input data
and construct the AEME object. The minimum inputs are the
<code>lake</code>, <code>time</code>, and <code>input</code> data.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Construct AEME object</span></span>
<span><span class="va">aeme</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aeme_constructor.html">aeme_constructor</a></span><span class="op">(</span>lake <span class="op">=</span> <span class="va">lake</span>, </span>
<span>                         time <span class="op">=</span> <span class="va">time</span>,</span>
<span>                         input <span class="op">=</span> <span class="va">input</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time step missing. Setting time step to 3600 seconds.</span></span>
<span><span class="co">#&gt; Spin up for models missing. Setting spin up to 2 for all models.</span></span></code></pre></div>
<div class="section level3">
<h3 id="view-aeme-object">View AEME object<a class="anchor" aria-label="anchor" href="#view-aeme-object"></a>
</h3>
<p>The AEME object can be inspected by printing it to the console. This
will show the inputs that have been use to construct the object along
with default values for inputs not provided.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aeme</span></span>
<span><span class="co">#&gt;             AEME </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Lake</span></span>
<span><span class="co">#&gt; Wainamu (ID: 45819); Lat: -36.89; Lon: 174.47; Elev: 29m; Depth: 13.07m;</span></span>
<span><span class="co">#&gt; Area: 156875.6 m2</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Time</span></span>
<span><span class="co">#&gt; Start: 2020-08-01; Stop: 2021-06-30; Time step: 3600</span></span>
<span><span class="co">#&gt;  Spin up (days): GLM: 2; GOTM: 2; DYRESM: 2</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Configuration</span></span>
<span><span class="co">#&gt;     Model controls: Absent </span></span>
<span><span class="co">#&gt;           Physical   |   Biogeochemical</span></span>
<span><span class="co">#&gt; DY-CD    : Absent     |   Absent </span></span>
<span><span class="co">#&gt; GLM-AED  : Absent     |   Absent </span></span>
<span><span class="co">#&gt; GOTM-WET : Absent     |   Absent </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Observations</span></span>
<span><span class="co">#&gt; Lake: Absent; Level: Absent</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Input</span></span>
<span><span class="co">#&gt; Inital profile: Absent; Inital depth: 13.07m; Hypsograph: Present (n=44);</span></span>
<span><span class="co">#&gt; Meteo: Present; Use longwave: TRUE; Kw: 1.31</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Inflows</span></span>
<span><span class="co">#&gt; Data: Absent; Scaling factors: DY-CD: 1; GLM-AED: 1; GOTM-WET: 1</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Outflows</span></span>
<span><span class="co">#&gt; Data: Absent; Scaling factors: DY-CD: 1; GLM-AED: 1; GOTM-WET: 1</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Water balance</span></span>
<span><span class="co">#&gt; Method: 2; Use: obs; Modelled: Absent; Water balance: Absent</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Parameters: </span></span>
<span><span class="co">#&gt; Number of parameters: 0</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Output: </span></span>
<span><span class="co">#&gt; Number of ensembles: 0</span></span>
<span><span class="co">#&gt; DY-CD:    </span></span>
<span><span class="co">#&gt; GLM-AED:  </span></span>
<span><span class="co">#&gt; GOTM-WET:</span></span></code></pre></div>
<p>In the configuration section of the output, under “Physical” and
“Biogeochemical” for each model are labelle “Absent”. This is because
the model configurations have not been built. This is done in the next
step.</p>
</div>
</div>
<div class="section level2">
<h2 id="building-the-aeme-ensemble">Building the AEME ensemble<a class="anchor" aria-label="anchor" href="#building-the-aeme-ensemble"></a>
</h2>
<div class="section level3">
<h3 id="model-controls">Model controls<a class="anchor" aria-label="anchor" href="#model-controls"></a>
</h3>
<p>The model controls are the settings for the AEME ensemble. These are
read in from a CSV file. The default CSV file is stored within the
package and can be accessed using the <code>get_model_controls</code>
function. It has the argument <code>use_bgc</code> which is a logical
value to indicate whether to simulate the default biogeochemical
variables with the hydrodynamic variables or just the hydrodynamic
variables.</p>
<p>The model controls has the following columns:</p>
<ul>
<li>
<code>var_aeme</code>: The variable name in the AEME object</li>
<li>
<code>simulate</code>: Whether to simulate the variable</li>
<li>
<code>inf_default</code>: The default inflow value</li>
<li>
<code>initial_wc</code>: The initial water column value</li>
<li>
<code>initial_sed</code>: The initial sediment value</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get model controls</span></span>
<span><span class="va">model_controls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_model_controls.html">get_model_controls</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">model_controls</span></span>
<span><span class="co">#&gt;       var_aeme simulate inf_default initial_wc initial_sed conversion_aed</span></span>
<span><span class="co">#&gt; 1     HYD_flow    FALSE          NA         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 2     HYD_temp     TRUE       15.00     11.000          NA     1.00000000</span></span>
<span><span class="co">#&gt; 3     HYD_dens    FALSE          NA         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 4      RAD_par    FALSE          NA         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 5     RAD_extc    FALSE          NA         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 6   RAD_secchi    FALSE          NA         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 7     CHM_salt     TRUE        0.00      0.000       0e+00     1.00000000</span></span>
<span><span class="co">#&gt; 8      CHM_oxy     TRUE       10.00     10.000       1e+01     0.03200000</span></span>
<span><span class="co">#&gt; 9      PHS_frp    FALSE        0.00      0.010       1e+06     0.03097376</span></span>
<span><span class="co">#&gt; 10     PHS_dop    FALSE        0.00      0.010       1e+06     0.03097376</span></span>
<span><span class="co">#&gt; 11    PHS_dopr    FALSE        0.00         NA          NA     0.03097376</span></span>
<span><span class="co">#&gt; 12     PHS_pop    FALSE        0.00      0.010       1e-04     0.03097376</span></span>
<span><span class="co">#&gt; 13    PHS_popr    FALSE        0.00         NA          NA     0.03097376</span></span>
<span><span class="co">#&gt; 14     PHS_pip    FALSE        0.00      0.002       5e-03     0.03097376</span></span>
<span><span class="co">#&gt; 15      PHS_tp    FALSE          NA         NA          NA     0.03097376</span></span>
<span><span class="co">#&gt; 16     NIT_amm    FALSE        0.05      0.020       1e+06     0.01400670</span></span>
<span><span class="co">#&gt; 17     NIT_nit    FALSE        0.20      0.015       1e+06     0.01400670</span></span>
<span><span class="co">#&gt; 18     NIT_don    FALSE        0.00      0.300       1e+06     0.01400670</span></span>
<span><span class="co">#&gt; 19    NIT_donr    FALSE        0.00         NA          NA     0.01400670</span></span>
<span><span class="co">#&gt; 20     NIT_pon    FALSE        0.00      0.100       1e-03     0.01400670</span></span>
<span><span class="co">#&gt; 21    NIT_ponr    FALSE        0.00         NA          NA     0.01400670</span></span>
<span><span class="co">#&gt; 22     NIT_pin    FALSE          NA      0.010       1e-03     0.01400670</span></span>
<span><span class="co">#&gt; 23      NIT_tn    FALSE          NA         NA          NA     0.01400670</span></span>
<span><span class="co">#&gt; 24     CAR_dic    FALSE       10.00      2.000       1e+06     0.01201100</span></span>
<span><span class="co">#&gt; 25     CAR_doc    FALSE        0.00      0.500       1e+06     0.01201100</span></span>
<span><span class="co">#&gt; 26    CAR_docr    FALSE        0.00         NA       1e+06     0.01201100</span></span>
<span><span class="co">#&gt; 27     CAR_poc    FALSE        0.00      0.200       1e-01     0.01201100</span></span>
<span><span class="co">#&gt; 28    CAR_pocr    FALSE        0.00         NA          NA     0.01201100</span></span>
<span><span class="co">#&gt; 29      CAR_ph    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 30     CAR_ch4    FALSE          NA         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 31     SIL_rsi    FALSE        0.00      1.000       1e+07     1.00000000</span></span>
<span><span class="co">#&gt; 32     BAC_bac    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 33   PHY_dinof    FALSE        0.10      1.000       0e+00     1.00000000</span></span>
<span><span class="co">#&gt; 34   PHY_cyano    FALSE        0.10      1.000       0e+00     1.00000000</span></span>
<span><span class="co">#&gt; 35   PHY_nodul    FALSE        0.10      1.000       0e+00     1.00000000</span></span>
<span><span class="co">#&gt; 36   PHY_green    FALSE        0.10      1.000       0e+00     1.00000000</span></span>
<span><span class="co">#&gt; 37   PHY_crypt    FALSE        0.10      1.000       0e+00     1.00000000</span></span>
<span><span class="co">#&gt; 38   PHY_mdiat    FALSE        0.10      1.000       0e+00     1.00000000</span></span>
<span><span class="co">#&gt; 39  PHY_diatom    FALSE        0.10      1.000       0e+00     1.00000000</span></span>
<span><span class="co">#&gt; 40   PHY_tchla    FALSE          NA         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 41     NCS_ss1    FALSE        5.00      3.000       3e-01     1.00000000</span></span>
<span><span class="co">#&gt; 42     NCS_ss2    FALSE        5.00      3.000       3e-01     1.00000000</span></span>
<span><span class="co">#&gt; 43     NCS_ss3    FALSE        5.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 44     NCS_ss4    FALSE        5.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 45     NCS_ss5    FALSE        5.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 46     NCS_ss6    FALSE        5.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 47     NCS_iss    FALSE          NA         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 48     NCS_tss    FALSE          NA         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 49    ZOO_zoo1    FALSE        0.10      1.000       0e+00     1.00000000</span></span>
<span><span class="co">#&gt; 50    ZOO_zoo2    FALSE        0.10         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 51    ZOO_zoo3    FALSE        0.10         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 52    ZOO_zoo4    FALSE        0.10         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 53    ZOO_zoo5    FALSE        0.10         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 54   FSH_fish1    FALSE        0.00      1.000          NA     1.00000000</span></span>
<span><span class="co">#&gt; 55   FSH_fish2    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 56   FSH_fish3    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 57   FSH_jelly    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 58 MAC_macalg1    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 59 MAC_macalg2    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 60 MAC_macalg3    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 61 MAC_macalg4    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 62   CLM_clam1    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 63   CLM_clam2    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 64   CLM_clam3    FALSE        0.00         NA          NA     1.00000000</span></span>
<span><span class="co">#&gt; 65     TRC_col    FALSE        0.00      0.000       0e+00     1.00000000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="build-the-ensemble">Build the ensemble<a class="anchor" aria-label="anchor" href="#build-the-ensemble"></a>
</h3>
<p>The <code>build_aeme</code> function will take the AEME object and
the model controls and build the ensemble. The <code>model</code>
argument is a character vector of the models to include in the ensemble.
The models available are <code>dy_cd</code>, <code>glm_aed</code>, and
<code>gotm_wet</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select models</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dy_cd"</span>, <span class="st">"glm_aed"</span>, <span class="st">"gotm_wet"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Path for model directory</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"aeme"</span></span>
<span></span>
<span><span class="co"># Build ensemble</span></span>
<span><span class="va">aeme</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_aeme.html">build_aeme</a></span><span class="op">(</span>aeme <span class="op">=</span> <span class="va">aeme</span>, model <span class="op">=</span> <span class="va">model</span>, model_controls <span class="op">=</span> <span class="va">model_controls</span>, </span>
<span>                   use_bgc <span class="op">=</span> <span class="cn">F</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Building simulation for Wainamu [2025-02-14 04:46:27]</span></span>
<span><span class="co">#&gt; No water level present. Using constant water level.</span></span>
<span><span class="co">#&gt; Estimating temperature using Stefan &amp; Preud'homme (2007)...</span></span>
<span><span class="co">#&gt; Correcting water balance using estimated outflows (method = 2).</span></span>
<span><span class="co">#&gt; Calculating lake level using lake depth and a sinisoidal function.</span></span>
<span><span class="co">#&gt; Warning in dir.create(lake_dir, showWarnings = TRUE): cannot create dir</span></span>
<span><span class="co">#&gt; 'aeme\45819_wainamu', reason 'No such file or directory'</span></span>
<span><span class="co">#&gt; Building DYRESM-CAEDYM for lake wainamu</span></span>
<span><span class="co">#&gt; Copied in DYRESM par file</span></span>
<span><span class="co">#&gt; Writing DYRESM configuration</span></span>
<span><span class="co">#&gt; Writing DYRESM control file</span></span>
<span><span class="co">#&gt; Building GLM3-AED2 model for lake wainamu</span></span>
<span><span class="co">#&gt; Copied in GLM nml file</span></span>
<span><span class="co">#&gt; Building GOTM-WET for lake wainamu</span></span>
<span><span class="co">#&gt; Copied all GOTM configuration files</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">aeme</span><span class="op">)</span></span>
<span><span class="co">#&gt;             AEME </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Lake</span></span>
<span><span class="co">#&gt; Wainamu (ID: 45819); Lat: -36.89; Lon: 174.47; Elev: 29m; Depth: 13.07m;</span></span>
<span><span class="co">#&gt; Area: 156875.6 m2</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Time</span></span>
<span><span class="co">#&gt; Start: 2020-08-01; Stop: 2021-06-30; Time step: 3600</span></span>
<span><span class="co">#&gt;  Spin up (days): GLM: 2; GOTM: 2; DYRESM: 2</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Configuration</span></span>
<span><span class="co">#&gt;     Model controls: Present</span></span>
<span><span class="co">#&gt;           Physical   |   Biogeochemical</span></span>
<span><span class="co">#&gt; DY-CD    : Present    |   Present</span></span>
<span><span class="co">#&gt; GLM-AED  : Present    |   Absent </span></span>
<span><span class="co">#&gt; GOTM-WET : Present    |   Present</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Observations</span></span>
<span><span class="co">#&gt; Lake: Absent; Level: Absent</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Input</span></span>
<span><span class="co">#&gt; Inital profile: Present; Inital depth: 13.07m; Hypsograph: Present (n=44);</span></span>
<span><span class="co">#&gt; Meteo: Present; Use longwave: TRUE; Kw: 1.31</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Inflows</span></span>
<span><span class="co">#&gt; Data: Absent; Scaling factors: DY-CD: 1; GLM-AED: 1; GOTM-WET: 1</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Outflows</span></span>
<span><span class="co">#&gt; Data: Present; Scaling factors: DY-CD: 1; GLM-AED: 1; GOTM-WET: 1</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Water balance</span></span>
<span><span class="co">#&gt; Method: 2; Use: obs; Modelled: Absent; Water balance: Present</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Parameters: </span></span>
<span><span class="co">#&gt; Number of parameters: 0</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;   Output: </span></span>
<span><span class="co">#&gt; Number of ensembles: 0</span></span>
<span><span class="co">#&gt; DY-CD:    </span></span>
<span><span class="co">#&gt; GLM-AED:  </span></span>
<span><span class="co">#&gt; GOTM-WET:</span></span></code></pre></div>
<p>By default, the <code>build_aeme</code> function will build the file
configuration for each model. This will create the necessary files for
each model to run. The files are also stored in the <code>aeme</code>
object in the <code>configuration</code> slot with a list for
hydrodynamic and ecosystem model configurations.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the files</span></span>
<span><span class="va">cfg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/configuration.html">configuration</a></span><span class="op">(</span><span class="va">aeme</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cfg</span><span class="op">[[</span><span class="st">"glm_aed"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "hydrodynamic" "ecosystem"</span></span></code></pre></div>
<p>All of the information and data needed to run an ensemble of models
is now contained within the <code>aeme</code> object. This allows for
easy storage of all the data and also for easy sharing of the data with
others. Sharing the <code>aeme</code> object with others allows them to
run the ensemble of models without needing to reconstruct the
object.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the ensemble</span></span>
<span><span class="va">aeme</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_aeme.html">run_aeme</a></span><span class="op">(</span>aeme <span class="op">=</span> <span class="va">aeme</span>, model <span class="op">=</span> <span class="va">model</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running models... (Have you tried parallelizing?) [2025-02-14 04:46:29]</span></span>
<span><span class="co">#&gt; DYRESM-CAEDYM running... [2025-02-14 04:46:29]</span></span>
<span><span class="co">#&gt; DYRESM-CAEDYM run successful! [2025-02-14 04:46:50]</span></span>
<span><span class="co">#&gt; GLM-AED running... [2025-02-14 04:46:50]</span></span>
<span><span class="co">#&gt; GLM-AED run successful! [2025-02-14 04:46:50]</span></span>
<span><span class="co">#&gt; GOTM-WET running... [2025-02-14 04:46:50]</span></span>
<span><span class="co">#&gt; GOTM-WET run successful! [2025-02-14 04:46:51]</span></span>
<span><span class="co">#&gt; Model run complete![2025-02-14 04:46:51]</span></span>
<span><span class="co">#&gt; Retrieving and formatting dyresmTEMPTURE_Var for model dy_cd</span></span>
<span><span class="co">#&gt; Retrieving and formatting dyresmSALINITY_Var for model dy_cd</span></span>
<span><span class="co">#&gt; Retrieving and formatting temp for model glm_aed</span></span>
<span><span class="co">#&gt; Retrieving and formatting salt for model glm_aed</span></span>
<span><span class="co">#&gt; Retrieving and formatting temp for model gotm_wet</span></span>
<span><span class="co">#&gt; Retrieving and formatting salt for model gotm_wet</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="view-the-output">View the output<a class="anchor" aria-label="anchor" href="#view-the-output"></a>
</h3>
<p>The output from the model run is stored in the <code>output</code>
slot of the <code>aeme</code> object. This is a list with a list for
each model. The list contains the output data from the model run.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the output</span></span>
<span><span class="fu"><a href="../reference/plot_output.html">plot_output</a></span><span class="op">(</span>aeme <span class="op">=</span> <span class="va">aeme</span>, model <span class="op">=</span> <span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 246 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_col()`).</span></span></code></pre></div>
<p><img src="setup-new-lake_files/figure-html/view-output-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="saving-the-aeme-object">Saving the AEME object<a class="anchor" aria-label="anchor" href="#saving-the-aeme-object"></a>
</h3>
<p>Saving the <code>aeme</code> object to a file can be done using the
<code>saveRDS</code> function. This will save the object to a file with
the <code>.rds</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save the AEME object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">aeme</span>, <span class="st">"aeme.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tadhg Moore.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
